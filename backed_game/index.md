---
layout: page
title: Backed demo
---

<div id="noJavaScript">
    Warning! You browser does not supports JavaScript or it is turned off. This demo will not work.
    <br/><br/>
</div>
<script type='text/javascript'>
    document.getElementById('noJavaScript').style.display = "none";
</script>

As explained in ["Cross-platform" article](../benefits/cross_platform) Webrogue can be compiled to run on the web.
As explained in ["Webrogue's bakeability" article](../benefits/bakeable.md) a game can be backed into Webrogue.
In this case this game is [log2048](../examples/log2048).
Backing method is "native".
Here is as example:

<label id="statusLabel"></label>
<canvas style="width: 100%;" id="canvas" oncontextmenu="event.preventDefault()"></canvas>

Webrogue is compiled for web using [Emscripten](https://emscripten.org/). 
Emscripten offers two ways to compile code into WebAssembly and into Asm.js. 
While WebAssembly offers better performance and lower network bandwidth, Asm.js can run on older browsers.
In this case webrogue check is WebAssembly feature is available and chooses if it needs to use WebAssembly or Asm.js.

WebAssembly code generated by Emscripten is generally not useable for Webrogue mods because Emscripten does not uses WASI. 

And vice versa, `.wrmod` files can't be natively backed into Webrogue, even if it is compiled to WebAssembly using Emscripten.
The main problem with such backing is that code executed in browser needs to be asynchronous.
Emscripten offers [Asyncify](https://emscripten.org/docs/porting/asyncify.html) feature, while Webrogue mods are generally synchronous. 

Lets just pretend that WebAssembly used in Webrogue mods and WebAssembly generated by Emscripten are two different WebAssemblies.
In this demo log2048 compiled to "Emscripten's WebAssembly" instead of "Webrogue's WebAssembly".
Try not to mix up them.


<script type='text/javascript'>
    var statusLabelElement = document.getElementById('statusLabel');

    var Module = {
        preRun: [
            function () {
                FS.mkdir('/webrogue');
                FS.mount(IDBFS, { root: '/' }, '/webrogue');
                FS.chdir('/webrogue');
                FS.syncfs(true, function (err) {
                // handle callback
                });
            }
        ],
        postRun: [],
        print: (function () {
            return function (text) {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                    console.log(text);
            };
        })(),
        canvas: (function () {
            var canvas = document.getElementById('canvas');

            // As a default initial behavior, pop up an alert when webgl context is lost. To make your
            // application robust, you may want to override this behavior before shipping!
            // See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
            canvas.addEventListener("webglcontextlost", function (e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);

            return canvas;
        })(),
        setStatus: function (text) {
            if (text == "Running...") text = "Loading Webrogue...";
            statusLabelElement.textContent = text
        },
        totalDependencies: 0,
    };
    Module.setStatus('Downloading...');
    window.onerror = function (event) {
        // TODO: do not warn on ok events like simulating an infinite loop or exitStatus
        Module.setStatus('Exception thrown, see JavaScript console');
        Module.setStatus = function (text) {
            if (text) console.error('[post-exception status] ' + text);
        };
    };
    fetch(typeof WebAssembly === 'undefined' ? "./webrogue_baked_game_asmjs.js" : "./webrogue_baked_game_wasm.js").then(function (response) {
        if (!response.ok) {
            return false;
        }
        return response.blob();
    }).then(function (myBlob) {
        var objectURL = URL.createObjectURL(myBlob);
        var sc = document.createElement("script");
        sc.setAttribute("src", objectURL);
        sc.setAttribute("type", "text/javascript");
        document.head.appendChild(sc);
    })
</script>
